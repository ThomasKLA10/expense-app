#!/bin/bash
set -e

# Create necessary directories
mkdir -p app/uploads
mkdir -p app/static/uploads
mkdir -p app/archive
mkdir -p temp
mkdir -p logs
mkdir -p data/postgresql

# Copy database schema if it exists
if [ -f data/db/schema_backup.sql ]; then
    cp data/db/schema_backup.sql data/postgresql/db.sql
    echo "Database schema copied for BBDeployor initialization"
fi

# Create Python virtual environment
python3 -m venv venv
source venv/bin/activate

# Install Python dependencies
pip install --no-cache-dir -r requirements.txt
deactivate

# Create default .env if not exists
if [ ! -f .env ]; then
    cp config/.env.example .env
fi

# Make scripts executable
chmod +x scripts/*.sh

# Send notification
bbdeployor message "Project build completed for receiptsbonn" 